<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Etusivu - SafkaShare</title>
  <link href="data:image/x-icon;base64,AAABAAEAEBAAAAEACABoBQAAFgAAACgAAAAQAAAAIAAAAAEACAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAeJ2nACRBbwB3hnUAC06fADVrdwAUi/EAKbT2AAFrpQAAVskAOmjrAAAkWQAcSEYABlfDAFiZZwALsPQAFXnXACik0AACZ8YAAGrGAAdClwAWYq4ADFCCAEp6dwARarQAD5TgACAxkQAPlOkAAAATAHGssQBQgdwAfoB/ACtFcwAbb7oAHpHgABF0yQCChXMADH/PAA9WTQAMHkgABV27AChpwwADN0IAFCE/ABhllABR0fMAFH7eACA8awAkKiQAG4fVAAxCoQAbZ6wABlaVAElgTwBGeJYAMo9DABBbiQAOTacAUfP2AAQAFAAPT6QAVlleAFHdxwAfVIYAGTRmAAwdRgAWdc0AsNrOAD9EcQALY8UAVYGxACulLAAPVoQAE1KBACBxlQANTZYABHXXABBSkwA2bdkAFKbiAARfugB9o8UAO5ivAC6bygAinCQAO3mAAICkyAAahcgAG37XAG6iqAAJVIgASX93ACeo6AAqRFgAttHqAAA+YgAAM3cACpH1ACtRtABJVGwAHbr6AGFpfQAKeckAgoZ5AByn1AAVfs8APnuQAA2S3gAAUrAAGpDYAEd3nwAWZMoACAAOABlQjwB6n8QAs8nLAITAhQADCB0ACIfZABRWswAKQooAQPLuABZmQgCu0ewABmTLABiB2QANZr8ACUWcAAdPlgCfydUAQHxEAB5jtgALNW0ADZvxABy+/wANbOMAFHnUAD51gAAmqNAAFGClAEBYTgABZc8AB2bAAAdjyQAEZ8wAEQ0tAAkSPAALl+8AGREeABVpyQANqe8APGmKACh3ogAdnOMArODKACuBpQALX9AAtNLoAERxmQASZsEAFEaPADxjggAGABEAFk+YADxofwAWl/kAF3DWAIWcvgAZWZsAOE1uAAxHgQAYRG8AAjpSAAdmywAeetkACWfFABNDhwALZcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHMBl0lIgDOhWYEAAAAAAEQaYqg4FloVV1ObBQAAAKkLhJKRO6JwlCtAmEqkAABBJxwwNYw9ZRcdUmovAgAAdYlbglRHNzqKEWhPLV0AZwx5PnomX2AEMilOCh5jJANVLHg0CCWHrTFvnHx/IB90KhRFI0xhGw+GmVwTlauaDqx3rhIGpZNrhRlkIrE/QwA2OY8oiEKvLn12lgdsRgAAnaCDjlAQjaaQaW1mo14AAAB7sEshfg0JWBiLcQAAAAAAAABRbqo8n02epwAAAAAAAAAAAAAAVnIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP//AADgBwAAwAMAAIABAACAAQAAgAEAAAAAAAAAAAAAAAAAAAAAAACAAQAAgAEAAMAHAADwDwAA/n8AAP//AAA=" rel="icon" type="image/x-icon">
  <!-- theme meta -->
  <meta name="theme-name" content="mono" />
  <!-- GOOGLE FONTS -->
  <link href="https://fonts.googleapis.com/css?family=Karla:400,700|Roboto" rel="stylesheet">
  <link href="plugins/material/css/materialdesignicons.min.css" rel="stylesheet" />
  <link href="plugins/simplebar/simplebar.css" rel="stylesheet" />
  <!-- PLUGINS CSS STYLE -->
  <link href="plugins/nprogress/nprogress.css" rel="stylesheet" />
  <link href="plugins/DataTables/DataTables-1.10.18/css/jquery.dataTables.min.css" rel="stylesheet" />
  <link href="plugins/jvectormap/jquery-jvectormap-2.0.3.css" rel="stylesheet" />
  <link href="plugins/daterangepicker/daterangepicker.css" rel="stylesheet" />
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <link href="plugins/toaster/toastr.min.css" rel="stylesheet" />
  <!-- MONO CSS -->
  <link id="main-css-href" rel="stylesheet" href="css/style.css" />
</head>

  <body class="navbar-fixed sidebar-fixed" id="body">
    <div id="toaster"></div>
    <!-- ====================================
    ——— WRAPPER
    ===================================== -->
    <div class="wrapper">
      
        <!-- ====================================
          ——— LEFT SIDEBAR WITH OUT FOOTER
        ===================================== -->
        <aside class="left-sidebar sidebar-dark" id="left-sidebar">
          <div id="sidebar" class="sidebar sidebar-with-footer">
            <!-- Aplication Brand -->
            <div class="app-brand">
              <a href="/index.html">
                <img src="images/logo.png" alt="Mono" class="sidebar-logo">
                <span class="brand-name"></span>
              </a>
            </div>
            <!-- begin sidebar scrollbar -->
              <!-- sidebar menu -->
              <ul class="nav sidebar-inner" id="sidebar-menu">
                
                  <li
                   class="active"
                   >
                    <a class="sidenav-item-link" href="index.html">
                      <i class="mdi mdi-briefcase-account-outline"></i>
                      <span class="nav-text">Etusivu</span>
                    </a>
                  </li>
                  <li>
                    <a class="sidenav-item-link" href="recipe-list.html">
                      <i class="mdi mdi-food-variant"></i>
                      <span class="nav-text">Hae reseptejä</span>
                    </a>
                  </li>

                  <li id="omatReseptit" class="hover-pointer">
                    <a class="sidenav-item-link">
                      <i class="mdi mdi-food-apple"></i>
                      <span class="nav-text">Omat reseptit</span>
                    </a>
                  </li>
                
                    <ul  class="collapse"  id="email"
                      data-parent="#sidebar-menu">
                      <div class="sub-menu">
                      </div>
                    </ul>
                  </li>
                

             <!--    <li class="section-title">
                    UI Elements
                  </li>
                --> 
          </div>
        </aside>


      <!-- ====================================
      ——— PAGE WRAPPER
      ===================================== -->
      <div class="page-wrapper">
        
          <!-- Header -->
          <header class="main-header" id="header">
            <nav class="navbar navbar-expand-lg navbar-light" id="navbar">
              <button id="sidebar-toggler" class="sidebar-toggle">
                <span class="sr-only">Toggle navigation</span>
              </button>

              <span class="page-title">Etusivu</span>

              <div class="navbar-right">
                <ul class="nav navbar-nav">
                    <button class="button nav-link" style="visibility: hidden;" id="logoutButton" disabled="true">Kirjaudu ulos</button>
                    <button class="button nav-link" id="loginButton">
                        <span class="d-none d-lg-inline-block" id="userLabel">Kirjaudu sisään</span>
                    </button>
                </ul>
                </li>
                  <script>
                    document.addEventListener('DOMContentLoaded', function() {

                        var storedName = sessionStorage.getItem('full_name');
                        // Check if data exists
                        if (storedName) {
                          // Display the retrieved data on the page
                          document.getElementById('loginButton').disabled = true;
                          document.getElementById('loginButton').style="color: black;";
                          document.getElementById('logoutButton').disabled = false;
                          document.getElementById('logoutButton').style="visibility: visible; color: red;";
                          document.getElementById('userLabel').textContent = storedName;
                        } else {
                          // If no data found in local storage
                          document.getElementById('loginButton').disabled = false;
                          document.getElementById('logoutButton').disabled = true;
                          document.getElementById('logoutButton').style="visibility: hidden;";
                          document.getElementById('userLabel').textContent = "Kirjaudu sisään";
                        }
                        const loginButton = document.getElementById('loginButton');
                        loginButton.addEventListener('click', function() {
                            window.location.href = 'login.html';
                        });
                        const logoutButton = document.getElementById('logoutButton');
                        logoutButton.addEventListener('click', function() {
                          sessionStorage.clear();
                            window.location.href = 'index.html';
                        });
                        const omatReseptitButton = document.getElementById('omatReseptit');
                        omatReseptitButton.addEventListener('click', function() {
                          var storedName = sessionStorage.getItem('full_name');
                          if (storedName) {
                            window.location.href = 'user-recipes.html';
                          } else {
                            window.location.href = 'login.html';
                          }
                            
                        });
                    });
                    </script>
              </div>
            </nav>
          </header>
                <!-- tästä alkaa table----------------------------------------------------------------------------------------------- - ------ ----->
                <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
              <script>
async function fetchRecipes() {
    try {
        const response = await fetch('https://funny-cuchufli-a98cc3.netlify.app/.netlify/functions/reseptit');
        if (!response.ok) {
            throw new Error('Failed to fetch recipes');
        }
        const recipes = await response.json();
        const urlParams = new URLSearchParams(window.location.search);
        const recipeId = urlParams.get('id'); 
        displayRecipes(recipes);
    } catch (error) {
        console.error('Error fetching recipes:', error);
    }
}

function displayRecipes(recipes) {
    const recipeList = document.getElementById('recipe-list');
    recipeList.innerHTML = ''; 

    const firstNineRecipes = recipes.slice(0, 9);

    firstNineRecipes.forEach(recipe => {
        if (recipe.visibility === 'public') { 

          const imageUrl = recipe.image_url || 'fallback-image-url.jpg'; 
          const ingredientsFormatted = recipe.ingredients.split(',').join('<br>');
          
            const card = document.createElement('div');
            card.classList.add('col');

            card.innerHTML = `
    <div class="card h-100">
        <img src="${imageUrl}" class="card-img-top recipe-card-image" alt="Recipe Image">
        <div class="card-body">
            <h5 class="card-title">${recipe.title}</h5>
            <p class="card-text">Ainesosat: ${ingredientsFormatted}</p>
            <a href="/recipe-details.html?_id=${recipe._id}" class="btn btn-primary">Näytä resepti</a>
        </div>
    </div>
`;

            recipeList.appendChild(card);
        }
    });
}
fetchRecipes();
                </script>
                
        <div class="container mt-5">
          <h1 class="text-center mb-4">Uusimmat herkulliset reseptit</h1>
          <div class="row row-cols-1 row-cols-md-3 g-4" id="recipe-list">
          </div>
      </div>

    <!--TÄHÄN LOPPUU TABLE ----------------------------------------------------------------------------------------------------------------------------->
                    <script src="plugins/jquery/jquery.min.js"></script>
                    <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
                    <script src="plugins/simplebar/simplebar.min.js"></script>
                    <script src="https://unpkg.com/hotkeys-js/dist/hotkeys.min.js"></script>
                    <script src="plugins/apexcharts/apexcharts.js"></script>
                    <script src="plugins/jvectormap/jquery-jvectormap-2.0.3.min.js"></script>
                    <script src="plugins/jvectormap/jquery-jvectormap-world-mill.js"></script>
                    <script src="plugins/jvectormap/jquery-jvectormap-us-aea.js"></script>
                    <script src="plugins/daterangepicker/moment.min.js"></script>
                    <script src="plugins/daterangepicker/daterangepicker.js"></script>
                 
                    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
                    <script src="js/mono.js"></script>
                    <script src="js/custom.js"></script>
  </body>
</html>
